{% extends 'moviepact/base.html' %}

{% block content %}


<style>
    .movie-container {
        padding-top: 100px;
        margin: 20px 0px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        width: 1000px;
    }

    .movie-container select {
        appearance: none;
        -moz-appearance: none;
        -webkit-appearance: none;
        border: 0;
        padding: 5px 15px;
        margin-bottom: 40px;
        font-size: 14px;
        border-radius: 5px;
    }

    .container {
        perspective: 1000px;
        margin: 40px 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .seat {
        background-color: #444451;
        height: 12px;
        width: 15px;
        margin: 3px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }

    .selected {
        background-color: #0081cb;
    }

    .occupied {
        background-color: #fff;
    }

    .seat:nth-of-type(2) {
        margin-right: 18px;
    }

    .seat:nth-last-of-type(2) {
        margin-left: 18px;
    }

    .seat:not(.occupied):hover {
        cursor: pointer;
        transform: scale(1.2);
    }

    .showcase .seat:not(.occupied):hover {
        cursor: default;
        transform: scale(1);
    }

    .showcase {
        display: flex;
        justify-content: space-between;
        list-style-type: none;
        background: rgba(0, 0, 0, 0.1);
        padding: 5px 10px;
        border-radius: 5px;
        color: #777;
    }

    .showcase li {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 10px;
    }

    .showcase li small {
        margin-left: 2px;
    }

    .row {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .screen {
        background: #fff;
        height: 70px;
        width: 70%;
        margin: 15px 0;
        transform: rotateX(-45deg);
        box-shadow: 0 3px 10px rgba(255, 255, 255, 0.7);
    }

    p.text {
        margin: 40px 0;
    }

    p.text span {
        color: #0081cb;
        font-weight: 600;
        box-sizing: content-box;
    }

    body {

        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        background-color: #242333;
        color: #fff;
        margin: 0;
    }

    * {

        box-sizing: border-box;
    }
</style>



<div class="movie-container">
    <h2>{{seance.movie.title}} {{seance.date}}</h2>
    <p id="movie" style="display: none;">{{seance.price}}</p>
    <ul class="showcase">
        <li>
            <div class="seat"></div>
            <small>Aviable</small>
        </li>
        <li>
            <div class="seat selected"></div>
            <small>Selected</small>
        </li>
        <li>
            <div class="seat occupied"></div>
            <small>Occupied</small>
        </li>
    </ul>

    <div class="container">
        <div class="screen"></div>

        <div class="row">
            <div class="seat" id="1-1"></div>
            <div class="seat" id="1-2"></div>
            <div class="seat" id="1-3"></div>
            <div class="seat" id="1-4"></div>
            <div class="seat" id="1-5"></div>
            <div class="seat" id="1-6"></div>
            <div class="seat" id="1-7"></div>
            <div class="seat" id="1-8"></div>
        </div>
        <div class="row">
            <div class="seat" id="2-1"></div>
            <div class="seat" id="2-2"></div>
            <div class="seat" id="2-3"></div>
            <div class="seat" id="2-4"></div>
            <div class="seat" id="2-5"></div>
            <div class="seat" id="2-6"></div>
            <div class="seat" id="2-7"></div>
            <div class="seat" id="2-8"></div>
        </div>
        <div class="row">
            <div class="seat" id="3-1"></div>
            <div class="seat" id="3-2"></div>
            <div class="seat" id="3-3"></div>
            <div class="seat" id="3-4"></div>
            <div class="seat" id="3-5"></div>
            <div class="seat" id="3-6"></div>
            <div class="seat" id="3-7"></div>
            <div class="seat" id="3-8"></div>
        </div>
        <div class="row">
            <div class="seat" id="4-1"></div>
            <div class="seat" id="4-2"></div>
            <div class="seat" id="4-3"></div>
            <div class="seat" id="4-4"></div>
            <div class="seat" id="4-5"></div>
            <div class="seat" id="4-6"></div>
            <div class="seat" id="4-7"></div>
            <div class="seat" id="4-8"></div>
        </div>
        <div class="row">
            <div class="seat" id="5-1"></div>
            <div class="seat" id="5-2"></div>
            <div class="seat" id="5-3"></div>
            <div class="seat" id="5-4"></div>
            <div class="seat" id="5-5"></div>
            <div class="seat" id="5-6"></div>
            <div class="seat" id="5-7"></div>
            <div class="seat" id="5-8"></div>
        </div>
        <div class="row">
            <div class="seat" id="6-1"></div>
            <div class="seat" id="6-2"></div>
            <div class="seat" id="6-3"></div>
            <div class="seat" id="6-4"></div>
            <div class="seat" id="6-5"></div>
            <div class="seat" id="6-6"></div>
            <div class="seat" id="6-7"></div>
            <div class="seat" id="6-8"></div>
        </div>

        <p class="text">
            You have selected <span id="count">0</span> seats for the total price of <span id="total">0</span>$
        </p>
    </div>
    <button type="button" class="btn btn-warning">
        Buy
    </button>
    <p id="taken-seats" style="display: none;">{{taken_seats}}</p>
</div>


<script>
    const container = document.querySelector('.container');
    const seats = document.querySelectorAll('.row .seat:not(.occupied)');
    const count = document.getElementById('count');
    const total = document.getElementById('total');
    const movieSelect = document.getElementById('movie');
    const taken_seats = document.getElementById('taken-seats').innerHTML.split(',')


    let ticketPrice = +movieSelect.innerHTML;
    let seatsNumbers = ''

    //Update total and count
    function updateSelectedCount() {
        const selectedSeats = document.querySelectorAll('.row .seat.selected');
        const selectedSeatsCount = selectedSeats.length;
        count.innerText = selectedSeatsCount;
        total.innerText = selectedSeatsCount * ticketPrice;
    }


    //Seat click event
    container.addEventListener('click', e => {
        if (e.target.classList.contains('seat') &&
            !e.target.classList.contains('occupied')) {
            e.target.classList.toggle('selected');
        }
        updateSelectedCount();
    });

    //Mark occupied seats
    console.log(taken_seats)
    for (const element of taken_seats){
        let seat = document.getElementById(element.trim())
        seat.classList.add('occupied')
    }
    
</script>


{% endblock %}